# ------------------------
# Bond repair
# ------------------------
CONFIG_ZMK_BLE_CLEAR_BONDS_ON_START=y

# ------------------------
# Split basics
# ------------------------
CONFIG_ZMK_SPLIT=y
CONFIG_ZMK_SPLIT_BLE=y
CONFIG_ZMK_SPLIT_ROLE_PERIPHERAL=y
CONFIG_BT=y
CONFIG_BT_PERIPHERAL=y

# ------------------------
# Xiao stability
# ------------------------
CONFIG_NFCT_PINS_AS_GPIOS=y

# ------------------------
# Logging
# ------------------------
CONFIG_LOG=y
CONFIG_LOG_DEFAULT_LEVEL=4
CONFIG_LOG_MODE_IMMEDIATE=y
CONFIG_PRINTK=y

# ------------------------
# USB CDC ACM console
# ------------------------
CONFIG_USB_DEVICE_STACK=y
CONFIG_USB_CDC_ACM=y
CONFIG_SERIAL=y
CONFIG_CONSOLE=y

# ここが重要
CONFIG_UART_CONSOLE=y
CONFIG_LOG_BACKEND_UART=y
CONFIG_USB_UART_CONSOLE=y


############################################################
# Keyboard Identification / AroundFortyRB_L (Peripheral)
############################################################

# ZMK 内部で使用されるキーボード名
CONFIG_ZMK_KEYBOARD_NAME="AroundFortyRB"

# Bluetooth デバイスとして OS に表示される名前
# ※ Split の peripheral は通常 OS に直接は接続しないが、
#   デバッグ時の識別を楽にするなら "AroundFortyRB_L" にしてもOK
CONFIG_BT_DEVICE_NAME="AroundFortyRB"

# BLE デバイス名の最大長（nRF52 の制限対策）
CONFIG_BT_DEVICE_NAME_MAX=16


############################################################
# Core ZMK Features (Peripheral 側でも必要な基盤)
############################################################

# Bluetooth LE キーボード機能（Split BLE の基盤）
CONFIG_ZMK_BLE=y

# Zephyr Input subsystem（ZMK 入力基盤）
# Input thread stack を指定しているため、peripheral 側でも有効化しておく
CONFIG_INPUT=y


############################################################
# nRF52840 Hardware Specific
############################################################

# NFC ピン（P0.09 / P0.10）を GPIO として再利用
# ※ NFC 機能は無効化される
CONFIG_NFCT_PINS_AS_GPIOS=y


############################################################
# BLE 試験的機能（macOS との相性を考慮して無効化）
CONFIG_ZMK_BLE_EXPERIMENTAL_FEATURES=n

# Bluetooth (Zephyr BLE stack) Memory / Buffer Tuning
CONFIG_BT_RX_STACK_SIZE=2048
CONFIG_BT_HCI_TX_STACK_SIZE=1024
CONFIG_BT_BUF_ACL_RX_SIZE=251
CONFIG_BT_BUF_ACL_TX_SIZE=251

# 接続パラメータの最適化 (AAA準拠: 15ms 固定)
CONFIG_BT_PERIPHERAL_PREF_MIN_INT=12
CONFIG_BT_PERIPHERAL_PREF_MAX_INT=12

# スリープ機能を有効化 (AAA準拠)
CONFIG_ZMK_SLEEP=y
CONFIG_ZMK_IDLE_TIMEOUT=30000
CONFIG_ZMK_IDLE_SLEEP_TIMEOUT=1800000

# ヒープ（bytes）
CONFIG_HEAP_MEM_POOL_SIZE=16384


############################################################
# RGB LED Widget (Status Visualization)
############################################################

# RGB LED ウィジェットを有効化
CONFIG_RGBLED_WIDGET=y

# バッテリー残量がこの値以上なら通常表示（%）
CONFIG_RGBLED_WIDGET_BATTERY_LEVEL_HIGH=30

# バッテリー残量がこの値以下で警告表示（%）
CONFIG_RGBLED_WIDGET_BATTERY_LEVEL_CRITICAL=10


############################################################
# Battery Reporting (Split Keyboard Support)
############################################################

# バッテリー残量レポート機能を有効化
CONFIG_ZMK_BATTERY_REPORTING=y

# Bluetooth Battery Service (OS へのバッテリー通知)
# ※ peripheral が OS に直接つながらない運用でも、Split 内部で使う場合がある
CONFIG_BT_BAS=y

# NOTE:
# Right が central なので、Left(peripheral) には以下の "CENTRAL 専用" は置かない：
# - CONFIG_ZMK_SPLIT_BLE_CENTRAL_BATTERY_LEVEL_PROXY
# - CONFIG_ZMK_SPLIT_BLE_CENTRAL_BATTERY_LEVEL_FETCHING
# - CONFIG_ZMK_SPLIT_BLE_CENTRAL_SPLIT_RUN_STACK_SIZE


############################################################
# Thread / Stack Size Tuning
# RGB + Split + BLE 構成向け
############################################################

# BLE 処理用スレッドスタック
CONFIG_ZMK_BLE_THREAD_STACK_SIZE=2048

# 低優先度タスク用スレッドスタック
CONFIG_ZMK_LOW_PRIORITY_THREAD_STACK_SIZE=2048

# Input subsystem 用スタック
CONFIG_INPUT_THREAD_STACK_SIZE=2048

# Split Peripheral 側 BLE スタック
CONFIG_ZMK_SPLIT_BLE_PERIPHERAL_STACK_SIZE=2048


############################################################
# Bluetooth PHY Configuration
############################################################

# BLE 2M PHY を無効化（安定性優先）
CONFIG_BT_CTLR_PHY_2M=n

# 接続数上限（左右で揃える）
CONFIG_BT_MAX_CONN=6
CONFIG_BT_MAX_PAIRED=6
